{"name":"Knockout-server-side-validation","tagline":"Knockout server side validation","body":"### Welcome to the knockout-server-side-validation page!\r\n\r\nknockout-server-side-validation is simple Javascript library for displaying server side errors in browser where elements are bounded to knockout view model. By default, each message from server is shown next to the element error belongs to. This behavior can be overridden. At this moment, this library enables you very simple integration with ASP.NET MVC server side validation, but if needed, it can be extended to use with some another framework.\r\n\r\nIf you want to show server side validation errors on client, when using AJAX call, and model is bounded with knockout you should do following:\r\n\r\n1. change way of knockout binding is done\r\n\r\n2. change way of handling validation messages on server\r\n\r\n3. change way of handling validation messages on client\r\n\r\n\r\n### Client side example\r\nFirst add reference to knockout-server-validation.\r\nThen, instead of\r\n```\r\nko.applyBindings(viewModel, rootNode);\r\n```\r\nuse\r\n```\r\nko.applyBindingsWithValidation(viewModel, rootNode);\r\n```\r\n\r\nFor ASP.NET MVC part, we will first add simple extension method\r\n```\r\npublic static class ModelStateExtensions\r\n  {\r\n    public static JsonResult ToKoJsonResult(this ModelStateDictionary modelState)\r\n    {\r\n      return new JsonResult() { Data = new { KoValid = modelState.IsValid, ModelState = modelState.ToKoJSON() } };\r\n    }\r\n\r\n    public static object ToKoJSON(this ModelStateDictionary modelState)\r\n    {\r\n      return modelState.Where(x => x.Value.Errors.Count > 0).Select(ms => new\r\n      {\r\n        Key = ms.Key,\r\n        //Value = string.Join(\",\", ms.Value.Errors.Select(x => x.ErrorMessage)),\r\n        Value = ms.Value.Errors.First().ErrorMessage\r\n      }).ToArray();\r\n    }\r\n  }\r\n```\r\nNow, we need to change how server handle validation errors. So, first in ASP.NET MVC we need to define attribute\r\n```\r\npublic class KoJsonValidateAttribute : ActionFilterAttribute\r\n  {\r\n    protected bool IgnoreValidation;\r\n\r\n    public KoJsonValidateAttribute(bool ignoreValidation = false)\r\n    {\r\n      this.IgnoreValidation = ignoreValidation;\r\n    }\r\n\r\n    public override void OnActionExecuting(ActionExecutingContext filterContext)\r\n    {\r\n      if (IgnoreValidation || !filterContext.HttpContext.Request.IsAjaxRequest())\r\n      {\r\n        return;\r\n      }\r\n      var modelState = filterContext.Controller.ViewData.ModelState;\r\n      if (!modelState.IsValid)\r\n      {\r\n        filterContext.HttpContext.Response.Clear();\r\n        filterContext.HttpContext.Response.StatusDescription = \"Validation error\";\r\n        filterContext.Result = modelState.ToKoJsonResult();\r\n        filterContext.Result.ExecuteResult(filterContext.Controller.ControllerContext);\r\n        filterContext.HttpContext.ClearError();\r\n        filterContext.HttpContext.Response.End();\r\n      }\r\n    }\r\n  }\r\n```\r\n\r\nNow, on action method in your controller, where you are posting data, add attribute to enable validation of data:\r\n```\r\n[HttpPost, KoJsonValidate]\r\n    public ActionResult Save(MyViewModel model)\r\n    {\r\n      //Save data from model\r\n      //For example, you can redirect to another page when validation passed, or something else, it depends application requirements. This response needs to be handled on client after validateModel returns true.\r\n      return Json(new { redirect = Url.Action(\"RedirectAction\") }));\r\n    }\r\n```\r\nAfter this, we need to add line of code when data is returned from server:\r\n```\r\nko.serverSideValidator.validateModel(viewModel, data);\r\n```\r\nviewModel is knockout model and data is data returned from server from AJAX call.\r\n\r\n### Dependencies\r\nknockout-server-side-validation has two dependencies: knockoutjs and jQuery.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}