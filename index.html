<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Knockout-server-side-validation : Knockout server side validation" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Knockout-server-side-validation</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/bojankaurin/knockout-server-side-validation">View on GitHub</a>

          <h1 id="project_title">Knockout-server-side-validation</h1>
          <h2 id="project_tagline">Knockout server side validation</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/bojankaurin/knockout-server-side-validation/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/bojankaurin/knockout-server-side-validation/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a name="welcome-to-the-knockout-server-side-validation-page" class="anchor" href="#welcome-to-the-knockout-server-side-validation-page"><span class="octicon octicon-link"></span></a>Welcome to the knockout-server-side-validation page!</h3>

<p>knockout-server-side-validation is simple Javascript library for displaying server side errors in browser where elements are bounded to knockout view model. By default, each message from server is shown next to the element error belongs to. This behavior can be overridden. At this moment, this library enables you very simple integration with ASP.NET MVC server side validation, but if needed, it can be extended to use with some another framework.</p>

<p>If you want to show server side validation errors on client, when using AJAX call, and model is bounded with knockout you should do following:</p>

<ol>
<li><p>change way of knockout binding is done</p></li>
<li><p>change way of handling validation messages on server</p></li>
<li><p>change way of handling validation messages on client</p></li>
</ol><h3>
<a name="client-side-example" class="anchor" href="#client-side-example"><span class="octicon octicon-link"></span></a>Client side example</h3>

<p>First add reference to knockout-server-validation.
Then, instead of</p>

<pre><code>ko.applyBindings(viewModel, rootNode);
</code></pre>

<p>use</p>

<pre><code>ko.applyBindingsWithValidation(viewModel, rootNode);
</code></pre>

<p>For ASP.NET MVC part, we will first add simple extension method</p>

<pre><code>public static class ModelStateExtensions
  {
    public static JsonResult ToKoJsonResult(this ModelStateDictionary modelState)
    {
      return new JsonResult() { Data = new { KoValid = modelState.IsValid, ModelState = modelState.ToKoJSON() } };
    }

    public static object ToKoJSON(this ModelStateDictionary modelState)
    {
      return modelState.Where(x =&gt; x.Value.Errors.Count &gt; 0).Select(ms =&gt; new
      {
        Key = ms.Key,
        //Value = string.Join(",", ms.Value.Errors.Select(x =&gt; x.ErrorMessage)),
        Value = ms.Value.Errors.First().ErrorMessage
      }).ToArray();
    }
  }
</code></pre>

<p>Now, we need to change how server handle validation errors. So, first in ASP.NET MVC way we need to define attribute</p>

<pre><code>public class KoJsonValidateAttribute : ActionFilterAttribute
  {
    protected bool IgnoreValidation;

    public KoJsonValidateAttribute(bool ignoreValidation = false)
    {
      this.IgnoreValidation = ignoreValidation;
    }

    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
      if (IgnoreValidation || !filterContext.HttpContext.Request.IsAjaxRequest())
      {
        return;
      }
      var modelState = filterContext.Controller.ViewData.ModelState;
      if (!modelState.IsValid)
      {
        filterContext.HttpContext.Response.Clear();
        filterContext.HttpContext.Response.StatusDescription = "Validation error";
        filterContext.Result = modelState.ToKoJsonResult();
        filterContext.Result.ExecuteResult(filterContext.Controller.ControllerContext);
        filterContext.HttpContext.ClearError();
        filterContext.HttpContext.Response.End();
      }
    }
  }
</code></pre>

<p>Now, on action method in your controller, where you are posting data, add attribute to enable validation of data:</p>

<pre><code>[HttpPost, KoJsonValidate]
    public ActionResult Save(MyViewModel model)
    {
      //Save data from model
      //For example, you can redirect to another page when validation passed, or something else, it depends application requirements. This response needs to be handled on client after validateModel returns true.
      return Json(new { redirect = Url.Action("RedirectAction") }));
    }
</code></pre>

<p>After this, we need to add line of code when data is returned from server:</p>

<pre><code>ko.serverSideValidator.validateModel(viewModel, data);
</code></pre>

<p>viewModel is knockout model and data is data returned from server from AJAX call.</p>

<h3>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h3>

<p>knockout-server-side-validation has two dependencies: knockoutjs and jQuery.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Knockout-server-side-validation maintained by <a href="https://github.com/bojankaurin">bojankaurin</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
